<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Find Your Car</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- JavaScript to validate range inputs -->
    <script type="text/javascript">
      function validateRanges() {
        var minYear = document.getElementById("min_year").value;
        var maxYear = document.getElementById("max_year").value;
        var minMileage = document.getElementById("min_mile").value;
        var maxMileage = document.getElementById("max_mile").value;
        var minPrice = document.getElementById("min_price").value;
        var maxPrice = document.getElementById("max_price").value;
        var searchButton = document.getElementById("search_button");
        var errorMessage = document.getElementById("error_message");

        // Reset the error message and enable the button
        errorMessage.style.display = "none";
        searchButton.disabled = false;

        // Check year range
        if (minYear && maxYear && parseInt(minYear) > parseInt(maxYear)) {
          errorMessage.style.display = "block";
          errorMessage.textContent =
            "Minimum year cannot be greater than maximum year.";
          searchButton.disabled = true;
          return;
        }

        // Check mileage range
        if (
          minMileage &&
          maxMileage &&
          parseInt(minMileage) > parseInt(maxMileage)
        ) {
          errorMessage.style.display = "block";
          errorMessage.textContent =
            "Minimum mileage cannot be greater than maximum mileage.";
          searchButton.disabled = true;
          return;
        }

        // Check price range
        if (minPrice && maxPrice && parseInt(minPrice) > parseInt(maxPrice)) {
          errorMessage.style.display = "block";
          errorMessage.textContent =
            "Minimum price cannot be greater than maximum price.";
          searchButton.disabled = true;
          return;
        }
      }
    </script>
  </head>
  <body>
    <div class="container mt-4">
      <h1 class="text-center">Find Your Car</h1>

      <!-- Filters Section -->
      <form action="" method="get">
        <!-- Make Dropdown -->
        <div class="row mt-4">
          <div class="col-md-12">
            <select class="form-control" name="make" id="make">
              <option value="">Select Make</option>
              {% for make in makes %}
              <option value="{{ make }}">{{ make }}</option>
              {% endfor %}
            </select>
          </div>
        </div>

        <!-- Year Dropdowns -->
        <div class="row mt-4">
          <div class="col-md-6">
            <select
              class="form-control"
              name="min_year"
              id="min_year"
              onchange="validateRanges()"
            >
              <option value="">Min Year</option>
              {% for year in years %}
              <option value="{{ year }}">{{ year }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-6">
            <select
              class="form-control"
              name="max_year"
              id="max_year"
              onchange="validateRanges()"
            >
              <option value="">Max Year</option>
              {% for year in years %}
              <option value="{{ year }}">{{ year }}</option>
              {% endfor %}
            </select>
          </div>
        </div>

        <!-- Mileage Dropdowns -->
        <div class="row mt-4">
          <div class="col-md-6">
            <select
              class="form-control"
              name="min_mile"
              id="min_mile"
              onchange="validateRanges()"
            >
              <option value="">Min Mileage</option>
              {% for mileage in mileages %}
              <option value="{{ mileage }}">{{ mileage }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-6">
            <select
              class="form-control"
              name="max_mile"
              id="max_mile"
              onchange="validateRanges()"
            >
              <option value="">Max Mileage</option>
              {% for mileage in mileages %}
              <option value="{{ mileage }}">{{ mileage }}</option>
              {% endfor %}
            </select>
          </div>
        </div>

        <!-- Price Dropdowns -->
        <div class="row mt-4">
          <div class="col-md-6">
            <select
              class="form-control"
              name="min_price"
              id="min_price"
              onchange="validateRanges()"
            >
              <option value="">Min Price</option>
              {% for price in prices %}
              <option value="{{ price }}">{{ price }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-6">
            <select
              class="form-control"
              name="max_price"
              id="max_price"
              onchange="validateRanges()"
            >
              <option value="">Max Price</option>
              {% for price in prices %}
              <option value="{{ price }}">{{ price }}</option>
              {% endfor %}
            </select>
          </div>
        </div>

        <!-- Search Button -->
        <div class="row mt-4">
          <div class="col-md-12 text-center">
            <button type="submit" class="btn btn-primary" id="search_button">
              Search
            </button>
          </div>
        </div>
      </form>

      <!-- Error Message -->
      <div
        id="error_message"
        style="display: none"
        class="alert alert-danger"
      ></div>

      <!-- Results Section -->
      <!-- Here you will include the logic to display the filtered results -->
    </div>

    <!-- Error Message -->
    <div id="error_message" style="display:none;" class="alert alert-danger"></div>

    <!-- Results Table -->
    <div class="row mt-4">
        <div class="col-md-12">
            {% if vehicles %}
                <table class="table">
                    <thead>
                        <tr>
                            <th>Listing ID</th>
                            <th>Vehicle ID</th>
                            <th>VIN</th>
                            <th>Make</th>
                            <th>Model</th>
                            <th>Year</th>
                            <th>Mileage</th>
                            <th>Price</th>
                            <!-- Add more headers based on the data available in 'vehicles' -->
                        </tr>
                    </thead>
                    <tbody>
                        {% for vehicle in vehicles %}
                        <tr>
                            <td>{{ vehicle.0 }}</td> <!-- Listing ID -->
                            <td>{{ vehicle.1 }}</td> <!-- Vehicle ID -->
                            <td>{{ vehicle.2 }}</td> <!-- VIN -->
                            <td>{{ vehicle.6 }}</td> <!-- Make -->
                            <td>{{ vehicle.7 }}</td> <!-- Model -->
                            <td>{{ vehicle.9 }}</td> <!-- Year -->
                            <td>{{ vehicle.10 }}</td> <!-- Mileage -->
                            <td>{{ vehicle.11 }}</td> <!-- Price -->
                            <!-- Add more data cells based on the data available in 'vehicle' -->
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p>No vehicles found.</p>
            {% endif %}
        </div>
    </div>
</div>


    <!-- Include Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
